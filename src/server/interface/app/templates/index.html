<!DOCTYPE html>

<html>

<head>
    <title> SmartSole - Console</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.4/dist/Chart.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css" integrity="sha384-Vkoo8x4CGsO3+Hhxv8T/Q5PaXtkKtu6ug5TOeNV6gBiFeWPGFN9MuhOf23Q9Ifjh" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.4.1.slim.min.js" integrity="sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js" integrity="sha384-Q6E9RHvbIyZFJoft+2mJbHaEWldlvI9IOYy5n3zV9zzTtmI3UksdQRVvoxMfooAo" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js" integrity="sha384-wfSDF2E50Y2D1uUdj0O3uMBJnjuUD4Ih7YwaYd1iqfktj0Uod8GCExl3Og8ifwB6" crossorigin="anonymous"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>
</head>


<body id="page-top">
    <div id="wrapper">

        <div class="d-flex flex-column" id="content-wrapper">
            <div id="content">
                <div class="container-fluid">
                    <div class="d-sm-flex justify-content-between align-items-center mb-4">
                        <h3 class="text-dark mb-0" style='margin-top: 20px'>SmartSole Dashboard</h3>
                    </div>
                    <div class="row">
                        <div class="col-md-6 col-xl-3 mb-4">
                            <div class="card shadow border-left-primary py-2">
                                <div class="card-body">
                                    <div class="row align-items-center no-gutters">
                                        <div id="stepsWalked" class="col mr-2">
                                            <div class="text-uppercase text-info font-weight-bold text-xs mb-1"><span>Steps walked today</span></div>
                                            <div class="text-dark font-weight-bold h5 mb-0"><span>No Data</span></div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-calendar fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-xl-3 mb-4">
                            <div class="card shadow border-left-info py-2">
                                <div class="card-body">
                                    <div class="row align-items-center no-gutters">
                                        <div class="col mr-2">
                                            <div class="text-uppercase text-info font-weight-bold text-xs mb-1"><span>Safe walking limit for today</span></div>
                                            <div class="row no-gutters align-items-center" id="stepProgressBar">
                                                <div class="col-auto">
                                                    <div class="text-dark font-weight-bold h5 mb-0 mr-3"><span>0%</span></div>
                                                </div>
                                                <div class="col">
                                                    <div class="progress progress-sm">
                                                        <div class="progress-bar bg-info" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;"><span class="sr-only">0%</span></div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-clipboard-list fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-xl-3 mb-4">
                            <div class="card shadow border-left-primary py-2">
                                <div class="card-body">
                                    <div class="row align-items-center no-gutters">
                                        <div id="averageTemperature" class="col mr-2">
                                            <div class="text-uppercase text-info font-weight-bold text-xs mb-1"><span>Average Temperature</span></div>
                                            <div class="text-dark font-weight-bold h5 mb-0"><span>No Data</span></div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-calendar fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 col-xl-3 mb-4">
                            <div class="card shadow border-left-success py-2">
                                <div class="card-body">
                                    <div class="row align-items-center no-gutters">
                                        <div id="averagePressure" class="col mr-2">
                                            <div class="text-uppercase text-info font-weight-bold text-xs mb-1"><span>Average Pressure</span></div>
                                            <div class="text-dark font-weight-bold h5 mb-0"><span>No Data</span></div>
                                        </div>
                                        <div class="col-auto"><i class="fas fa-dollar-sign fa-2x text-gray-300"></i></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Start: Chart -->
                    <div class="row">
                        <div class="col-lg-6 col-xl-6">
                            <div class="card shadow mb-4">
                                <div class="card-header d-flex justify-content-center align-items-center align-text-center">
                                    <h3 class="text-primary font-weight-bold m-0 text-center"> Temperature of sole of shoe </h3>
                                </div>
                                <div class="card-body" style="height: 400px">
                                    <div id="temperatureChart" style="height: 100%; width: 100%;"></div>
                                    <script src="https://canvasjs.com/assets/script/jquery-1.11.1.min.js"></script>
                                    <script src="https://canvasjs.com/assets/script/jquery.canvasjs.min.js"></script>
                                    <div style="margin-top:16px;color:dimgrey;font-size:9px;font-family: Verdana, Arial, Helvetica, sans-serif;text-decoration:none;"></div>
                                    <!-- <div class="chart-area"><canvas data-bs-chart="{&quot;type&quot;:&quot;line&quot;,&quot;data&quot;:{&quot;labels&quot;:[&quot;Jan&quot;,&quot;Feb&quot;,&quot;Mar&quot;,&quot;Apr&quot;,&quot;May&quot;,&quot;Jun&quot;,&quot;Jul&quot;,&quot;Aug&quot;],&quot;datasets&quot;:[{&quot;label&quot;:&quot;Earnings&quot;,&quot;fill&quot;:true,&quot;data&quot;:[&quot;0&quot;,&quot;10000&quot;,&quot;5000&quot;,&quot;15000&quot;,&quot;10000&quot;,&quot;20000&quot;,&quot;15000&quot;,&quot;25000&quot;],&quot;backgroundColor&quot;:&quot;rgba(78, 115, 223, 0.05)&quot;,&quot;borderColor&quot;:&quot;rgba(78, 115, 223, 1)&quot;}]},&quot;options&quot;:{&quot;maintainAspectRatio&quot;:false,&quot;legend&quot;:{&quot;display&quot;:false},&quot;title&quot;:{},&quot;scales&quot;:{&quot;xAxes&quot;:[{&quot;gridLines&quot;:{&quot;color&quot;:&quot;rgb(234, 236, 244)&quot;,&quot;zeroLineColor&quot;:&quot;rgb(234, 236, 244)&quot;,&quot;drawBorder&quot;:false,&quot;drawTicks&quot;:false,&quot;borderDash&quot;:[&quot;2&quot;],&quot;zeroLineBorderDash&quot;:[&quot;2&quot;],&quot;drawOnChartArea&quot;:false},&quot;ticks&quot;:{&quot;fontColor&quot;:&quot;#858796&quot;,&quot;padding&quot;:20}}],&quot;yAxes&quot;:[{&quot;gridLines&quot;:{&quot;color&quot;:&quot;rgb(234, 236, 244)&quot;,&quot;zeroLineColor&quot;:&quot;rgb(234, 236, 244)&quot;,&quot;drawBorder&quot;:false,&quot;drawTicks&quot;:false,&quot;borderDash&quot;:[&quot;2&quot;],&quot;zeroLineBorderDash&quot;:[&quot;2&quot;]},&quot;ticks&quot;:{&quot;fontColor&quot;:&quot;#858796&quot;,&quot;padding&quot;:20}}]}}}"></canvas></div> -->
                                </div>
                            </div>
                        </div>
                        <div class="col-lg-6 col-xl-6">
                            <div class="card shadow mb-4">
                                <div class="card-header d-flex justify-content-center align-items-center align-text-center">
                                    <h3 class="text-primary font-weight-bold m-0 text-center"> Pressure on sole of shoe </h3>
                                </div>
                                <div class="card-body" style="height: 400px">
                                    <div id="pressureChart" style="height: 100%; width: 100%;"></div>
                                    <!-- <div class="chart-area"><canvas data-bs-chart="{&quot;type&quot;:&quot;line&quot;,&quot;data&quot;:{&quot;labels&quot;:[&quot;Jan&quot;,&quot;Feb&quot;,&quot;Mar&quot;,&quot;Apr&quot;,&quot;May&quot;,&quot;Jun&quot;,&quot;Jul&quot;,&quot;Aug&quot;],&quot;datasets&quot;:[{&quot;label&quot;:&quot;Earnings&quot;,&quot;fill&quot;:true,&quot;data&quot;:[&quot;0&quot;,&quot;10000&quot;,&quot;5000&quot;,&quot;15000&quot;,&quot;10000&quot;,&quot;20000&quot;,&quot;15000&quot;,&quot;25000&quot;],&quot;backgroundColor&quot;:&quot;rgba(78, 115, 223, 0.05)&quot;,&quot;borderColor&quot;:&quot;rgba(78, 115, 223, 1)&quot;}]},&quot;options&quot;:{&quot;maintainAspectRatio&quot;:false,&quot;legend&quot;:{&quot;display&quot;:false},&quot;title&quot;:{},&quot;scales&quot;:{&quot;xAxes&quot;:[{&quot;gridLines&quot;:{&quot;color&quot;:&quot;rgb(234, 236, 244)&quot;,&quot;zeroLineColor&quot;:&quot;rgb(234, 236, 244)&quot;,&quot;drawBorder&quot;:false,&quot;drawTicks&quot;:false,&quot;borderDash&quot;:[&quot;2&quot;],&quot;zeroLineBorderDash&quot;:[&quot;2&quot;],&quot;drawOnChartArea&quot;:false},&quot;ticks&quot;:{&quot;fontColor&quot;:&quot;#858796&quot;,&quot;padding&quot;:20}}],&quot;yAxes&quot;:[{&quot;gridLines&quot;:{&quot;color&quot;:&quot;rgb(234, 236, 244)&quot;,&quot;zeroLineColor&quot;:&quot;rgb(234, 236, 244)&quot;,&quot;drawBorder&quot;:false,&quot;drawTicks&quot;:false,&quot;borderDash&quot;:[&quot;2&quot;],&quot;zeroLineBorderDash&quot;:[&quot;2&quot;]},&quot;ticks&quot;:{&quot;fontColor&quot;:&quot;#858796&quot;,&quot;padding&quot;:20}}]}}}"></canvas></div> -->
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- End: Chart -->
                </div>
            </div>
        </div><a class="border rounded d-inline scroll-to-top" href="#page-top"><i class="fas fa-angle-up"></i></a></div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.5.0/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.8.0/Chart.bundle.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.4.1/jquery.easing.js"></script>
    <!-- <div>
        <img src="/plot.png" alt="Data loading is broken" width='400' height='400'>
    </div> -->


    <script>
        window.onload = function() {
            var temperatures = [],
                temperature_limit = [],
                pressures = [],
                pressure_limit = [],
                steps = 0,
                status = "No data";

            var temperature_chart = new CanvasJS.Chart("temperatureChart", {
                theme: "light2",
                axisY: {
                    title: "Temperature",
                    suffix: "\xB0C",
                    maximum: 50,
                    minimum: 20,
                },
                toolTip: {
                    content: "{x}: {y}"
                },
                legend: {
                    cursor: "pointer",
                    verticalAlign: "top",
                    horizontalAlign: "middle",
                    dockInsidePlotArea: true,
                },
                data: [{
                    type: "line",
                    name: "Your data",
                    showInLegend: true,
                    dataPoints: temperatures,
                    xValueFormatString: "HH:mm:ss"
                },
                {
                    type: "line",
                    name: "Safety limit",
                    markerSize: 0,
                    showInLegend: true,
                    dataPoints: temperature_limit,
                    xValueFormatString: "HH:mm:ss"
                }
                ]
            });

            var pressure_chart = new CanvasJS.Chart("pressureChart", {
                theme: "light2",
                //title: {
                //    text: "Pressure"
                //},
                axisY: {
                    title: "Pressure",
                    suffix: " psi",
                    maximum: 25,
                    minimum: 10,
                },
                toolTip: {
                    content: "{x}: {y}"
                },
                legend: {
                    cursor: "pointer",
                    verticalAlign: "top",
                    horizontalAlign: "middle",
                    dockInsidePlotArea: true,
                },
                data: [{
                    type: "line",
                    name: "Your data",
                    showInLegend: true,
                    dataPoints: pressures,
                    xValueFormatString: "HH:mm:ss"
                },
                {
                    type: "line",
                    name: "Safety limit",
                    markerSize: 0,
                    showInLegend: true,
                    dataPoints: pressure_limit,
                    xValueFormatString: "HH:mm:ss"
                }
                ]
            });

            var temp_alert = true, pressure_alert = true, step_alert = true;
            function reset_alert() {temp_alert = true; pressure_alert = true; step_alert = true;}
            function updateData() {
                // poll the data from python and make all_data equal to it
                //$.getJSON("/data", (a) => {
                //    temperatures.push({
                //        y: a['temperature'][0],
                //        x: i
                //    })
                //    i += 1;
                //});

                $.getJSON('/data', (res) => {
                    length = Object.keys(res['time']).length;
                    for (var i = 0; i < length; i++){
                        var t = new Date( parseFloat(res['time'][i])*1000 );
                        temperatures.push( {'x': t, 'y': res['temperature'][i]} )
                        temperature_limit.push( {'x': t, 'y': 37} )
                        pressures.push( {'x': t, 'y': res['max_pressure'][i]})
                        pressure_limit.push( {'x': t, 'y': 20} )

                        // only keep 10 minutes of data 
                        while (temperatures.length > 300){
                            temperatures.shift();
                            temperature_limit.shift();
                            pressures.shift();
                            pressure_limit.shift();
                        }
                    }
                    steps = res['total_steps'];
                    avg_temp = res['avg_temperature'];
                    max_pressure = res['max_pressure_single'];
                    var percentage = Math.floor(steps * 100 / 2600);
                    if (percentage > 100) {percentage = 100}

                    var step_status = 'dark';
                    var pressure_status = 'dark';
                    var temp_status = 'dark';
                    if (steps >= 2600) { step_status = 'danger'; if (step_alert) {alert('Please stop walking as soon as possible. You are endangering your ulcer.'); step_alert = false}}
                    if (max_pressure >= 20) { pressure_status = 'danger'; if (pressure_alert) {alert('You are placing too much pressure on your foot.'); pressure_alert = false;}}
                    if (avg_temp >= 37) { temp_status = 'danger'; if (temp_alert) {alert('Your foot is too hot. Try to cool it down.'); temp_alert = false;}}

                    $("#averageTemperature").html(`
                        <div class="text-uppercase text-info font-weight-bold text-xs mb-1"><span>Average Temperature</span></div>
                        <div class="text-${temp_status} font-weight-bold h5 mb-0"><span> ${avg_temp.toString()}\xB0C </span></div>
                    `);
                    $("#stepsWalked").html(`
                        <div class="text-uppercase text-info font-weight-bold text-xs mb-1"><span>Steps walked today</span></div>
                        <div class="text-${step_status} font-weight-bold h5 mb-0"><span>${steps.toString()}</span></div>
                    `);
                    $("#averagePressure").html(`
                        <div class="text-uppercase text-info font-weight-bold text-xs mb-1"><span>Recent Pressure Maximum</span></div>
                        <div class="text-${pressure_status} font-weight-bold h5 mb-0"><span>${max_pressure.toString()} psi</span></div>
                    `);
                    $("#stepProgressBar").html(`
                        <div class="col-auto">
                            <div class="text-dark font-weight-bold h5 mb-0 mr-3"><span>${percentage}%</span></div>
                        </div>
                        <div class="col">
                            <div class="progress progress-sm">
                                <div class="progress-bar bg-info" aria-valuenow="${percentage}" aria-valuemin="0" aria-valuemax="100" style="width: ${percentage}%;"><span class="sr-only">${percentage}%</span></div>
                            </div>
                        </div>
                    `);
                })

                temperature_chart.render();
                pressure_chart.render();

            }
            setInterval(updateData, 5000);
            setInterval(updateData, 240000);


            //// Initial Values
            //var xValue = 0;
            //var yValue = 10;
            //var newDataCount = 6;

            //function addData(data) {
            //    if (newDataCount != 1) {
            //        $.each(data, function(key, value) {
            //            dataPoints.push({
            //                x: value[0],
            //                y: parseInt(value[1])
            //            });
            //            xValue++;
            //            yValue = parseInt(value[1]);
            //        });
            //    } else {
            //        //dataPoints.shift();
            //        dataPoints.push({
            //            x: data[0][0],
            //            y: parseInt(data[0][1])
            //        });
            //        xValue++;
            //        yValue = parseInt(data[0][1]);
            //    }

            //    newDataCount = 1;
            //    chart.render();
            //}


        }
    </script>
</body>
